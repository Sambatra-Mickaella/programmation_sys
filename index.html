<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des fichiers partagés</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Gestion SmartDrive</h1>
        <!-- Formulaire de connexion -->
        <div id="loginSection">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title mb-3">Connexion</h4>
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label for="username" class="form-label">Nom d'utilisateur</label>
                                    <input type="text" class="form-control" id="username" required>
                                </div>
                                <div class="mb-3">
                                    <label for="password" class="form-label">Mot de passe</label>
                                    <input type="password" class="form-control" id="password" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Se connecter</button>
                                <div id="loginError" class="text-danger mt-2" style="display:none;"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Interface principale cachée tant que non connecté -->
        <div id="mainSection" style="display:none;">
            <!-- Onglets Bootstrap -->
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="serveur-tab" data-bs-toggle="tab" data-bs-target="#serveur" type="button" role="tab" aria-controls="serveur" aria-selected="true">Côté Serveur</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="client-tab" data-bs-toggle="tab" data-bs-target="#client" type="button" role="tab" aria-controls="client" aria-selected="false">Côté Client</button>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <!-- Serveur -->
                <div class="tab-pane fade show active p-4" id="serveur" role="tabpanel" aria-labelledby="serveur-tab">
                    <div class="row">
                        <div class="col-md-4">
                            <h4>Utilisateurs</h4>
                            <ul class="list-group" id="userList">
                                <li class="list-group-item active">alice</li>
                                <li class="list-group-item">bob</li>
                                <li class="list-group-item">micka</li>
                            </ul>
                        </div>
                        <div class="col-md-8">
                            <h4>Fichiers de <span id="currentUser">alice</span></h4>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nom du fichier</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="fileList">
                                    <tr>
                                        <td>metyfona.txt</td>
                                        <td><button class="btn btn-primary btn-sm">Télécharger</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Client -->
                <div class="tab-pane fade p-4" id="client" role="tabpanel" aria-labelledby="client-tab">
                    <div class="row">
                        <div class="col-md-6">
                            <h4>Mes fichiers</h4>
                            <ul class="list-group" id="clientFileList">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    metyfona.txt
                                    <button class="btn btn-success btn-sm">Télécharger</button>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    monfichier.txt
                                    <button class="btn btn-success btn-sm">Télécharger</button>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h4>Uploader un fichier</h4>
                            <form>
                                <div class="mb-3">
                                    <input class="form-control" type="file" id="formFile">
                                </div>
                                <button type="submit" class="btn btn-primary">Uploader</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Gestion affichage login/main
        const loginSection = document.getElementById('loginSection');
        const mainSection = document.getElementById('mainSection');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');


        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                // Envoi POST au serveur Java
                fetch('http://localhost:4567/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loginSection.style.display = 'none';
                        mainSection.style.display = 'block';
                    } else {
                        loginError.textContent = "Nom d'utilisateur ou mot de passe incorrect.";
                        loginError.style.display = 'block';
                    }
                })
                .catch(() => {
                    loginError.textContent = "Erreur de connexion au serveur.";
                    loginError.style.display = 'block';
                });
            });
        }

        // Serveur : gestion utilisateurs/fichiers
        const users = {
            alice: ['metyfona.txt'],
            bob: ['metyfona.txt', 'monfichier.txt'],
            micka: ['metyfona.txt', 'monfichier.txt']
        };
        const userList = document.getElementById('userList');
        const fileList = document.getElementById('fileList');
        const currentUser = document.getElementById('currentUser');
        if (userList) {
            userList.addEventListener('click', function(e) {
                if (e.target.classList.contains('list-group-item')) {
                    document.querySelectorAll('.list-group-item').forEach(item => item.classList.remove('active'));
                    e.target.classList.add('active');
                    const user = e.target.textContent;
                    currentUser.textContent = user;
                    fileList.innerHTML = users[user].map(f => `<tr><td>${f}</td><td><button class='btn btn-primary btn-sm'>Télécharger</button></td></tr>`).join('');
                }
            });
        }
    </script>
</body>
</html>
